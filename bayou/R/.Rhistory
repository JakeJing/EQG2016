This is active                :active,        first_2,    2014-01-09, 3d
Do this later                 :               first_3,    after first_2, 5d
Do this after that            :               first_4,    after first_3, 5d
section Important Things
Completed, critical task      :crit, done,    import_1,   2014-01-06,24h
Also done, also critical      :crit, done,    import_2,   after import_1, 2d
Doing this important task now :crit, active,  import_3,   after import_2, 3d
Next critical task            :crit,          import_4,   after import_3, 5d
section The Extras
First extras                  :active,        extras_1,   after import_4,  3d
Second helping                :               extras_2,   after extras_1, 20h
More of the extras            :               extras_3,   after extras_1, 48h
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title A Very Nice Gantt Diagram
section TreeTimer
Build TreeTimer               :active,          first_1,    2014-01-06, 2014-01-08
This is active                :active,        first_2,    2014-01-09, 3d
Do this later                 :               first_3,    after first_2, 5d
Do this after that            :               first_4,    after first_3, 5d
section Important Things
Completed, critical task      :crit, done,    import_1,   2014-01-06,24h
Also done, also critical      :crit, done,    import_2,   after import_1, 2d
Doing this important task now :crit, active,  import_3,   after import_2, 3d
Next critical task            :crit,          import_4,   after import_3, 5d
section The Extras
First extras                  :active,        extras_1,   after import_4,  3d
Second helping                :               extras_2,   after extras_1, 20h
More of the extras            :               extras_3,   after extras_1, 48h
")
library(DiagrammeR)
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-09-01
This is active                :active,        first_2,    2014-01-09, 3d
Do this later                 :active,        first_3,    after first_2, 5d
Do this after that            :active,        first_4,    after first_3, 5d
section Important Things
Completed, critical task      :crit, done,    import_1,   2014-01-06,24h
Also done, also critical      :crit, done,    import_2,   after import_1, 2d
Doing this important task now :crit, active,  import_3,   after import_2, 3d
Next critical task            :crit,          import_4,   after import_3, 5d
section The Extras
First extras                  :active,        extras_1,   after import_4,  3d
Second helping                :               extras_2,   after extras_1, 20h
More of the extras            :               extras_3,   after extras_1, 48h
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-11-01, 2018-01-01
Do this after that            :active,        first_4,    after first_3, 5d
section Important Things
Completed, critical task      :crit, done,    import_1,   2017-01-06,24h
Also done, also critical      :crit, done,    import_2,   after import_1, 2d
Doing this important task now :crit, active,  import_3,   after import_2, 3d
Next critical task            :crit,          import_4,   after import_3, 5d
section The Extras
First extras                  :active,        extras_1,   after import_4,  3d
Second helping                :               extras_2,   after extras_1, 20h
More of the extras            :               extras_3,   after extras_1, 48h
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
Do this after that            :active,        first_4,    after first_3, 5d
section Methods Development
Completed, critical task      :crit, done,    import_1,   2017-01-06,24h
Also done, also critical      :crit, done,    import_2,   after import_1, 2d
Doing this important task now :crit, active,  import_3,   after import_2, 3d
Next critical task            :crit,          import_4,   after import_3, 5d
section Metabolic Data Acquisition
Build Metabolic Trait Dataset, Version 1 :active,        2017-06-01,   6mo
Second helping                :               extras_2,   after extras_1, 20h
More of the extras            :               extras_3,   after extras_1, 48h
")
library(DiagrammeR)
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
Do this after that            :active,        first_4,    after first_3, 5d
section Methods Development
Completed, critical task      :crit, done,    import_1,   2017-01-06,24h
Also done, also critical      :crit, done,    import_2,   after import_1, 2d
Doing this important task now :crit, active,  import_3,   after import_2, 3d
Next critical task            :crit,          import_4,   after import_3, 5d
section Metabolic Trait Analysis
Build Metabolic Trait Dataset, Version 1 :active,        2017-06-01, 180d
:               extras_2,   after extras_1, 20h
More of the extras            :               extras_3,   after extras_1, 48h
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
Do this after that            :active,        first_4,    after first_3, 5d
section Methods Development
Completed, critical task      :crit, done,    import_1,   2017-01-06,24h
Also done, also critical      :crit, done,    import_2,   after import_1, 2d
Doing this important task now :crit, active,  import_3,   after import_2, 3d
Next critical task            :crit,          import_4,   after import_3, 5d
section Metabolic Trait Analysis
Build Dataset, Version 1      :active,        analysis_1, 2017-06-01, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
Do this after that            :active,        first_4,    after first_3, 5d
section Methods Development
Completed, critical task      :crit, done,    import_1,   2017-06-01,24h
Also done, also critical      :crit, done,    import_2,   after import_1, 2d
Doing this important task now :crit, active,  import_3,   after import_2, 3d
Next critical task            :crit,          import_4,   after import_3, 5d
section Metabolic Trait Analysis
Build Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
Do this after that            :active,        first_4,    after first_3, 5d
section Methods Development
Implement multivariate bayou  :active,        import_1,   2018-01-01,180d
section Metabolic Trait Analysis
Build Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
Do this after that            :active,        first_4,    after first_3, 5d
section Methods Development
Implement multivariate bayou  :active,        import_1,   2018-01-01,180d
Simulation study of bayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis   :active,        analysis_3, after import1, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
Do this after that            :active,        first_4,    after first_3, 5d
section Methods Development
Implement multivariate bayou  :active,        import_1,   2018-01-01,180d
Simulation study of bayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis   :active,        analysis_3, after import_1, 180d
")
library(DiagrammeR)
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Implement multivariate bayou  :active,        import_1,   2018-01-01,180d
Simulation study of bayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis   :active,        analysis_3, after import_1, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Implement multivariate bayou  :active,        import_1,   2018-01-01,180d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis   :active,        analysis_3, after import_1, 180d
")
library(DiagrammeR)
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Multivariate bayou  :active,        import_1,   2018-01-01,180d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis   :active,        analysis_3, after import_1, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Multivariate bayou  :active,        import_1,   2018-01-01,180d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Invert Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis, Inverts     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis, Inverts   :active,        analysis_3, after import_1, 180d
Univariate Trait Analysis, Verts       :active,        analysis_4, 2017-06-01, 2018-01-01
Multivariate Trait Analysis, Verts     :active,        analysis_5, after import_1, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Multivariate bayou  :active,        import_1,   2018-01-01,180d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Invert Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis, Inverts     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis, Inverts   :active,        analysis_3, after import_1, 180d
Univariate Trait Analysis, Verts       :active,        analysis_4, 2017-06-01, 2018-07-01
Multivariate Trait Analysis, Verts     :active,        analysis_5, after import_1, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Improve bayou priors, identifiability  :active, import_0, 2017-06-01, 2018-01-01
Multivariate bayou  :active,        import_1,   2018-01-01,180d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Invert Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis, Inverts     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis, Inverts   :active,        analysis_3, after import_1, 180d
Univariate Trait Analysis, Verts       :active,        analysis_4, 2017-06-01, 2018-07-01
Multivariate Trait Analysis, Verts     :active,        analysis_5, after import_1, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Tree          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Improve bayou priors, identifiability  :active, import_0, 2017-06-01, 2018-01-01
Multivariate bayou  :active,        import_1,   2018-01-01,240d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Invert Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis, Inverts     :active,        analysis_2, after analysis_1, 120d
Multivariate Trait Analysis, Inverts   :active,        analysis_3, after import_1, 180d
Univariate Trait Analysis, Verts       :active,        analysis_4, 2017-06-01, 2018-07-01
Multivariate Trait Analysis, Verts     :active,        analysis_5, after import_1, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Trees          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Improve bayou priors, identifiability  :active, import_0, 2017-06-01, 2018-01-01
Multivariate bayou  :active,        import_1,   2018-01-01,240d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Invert Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis, Inverts     :active,        analysis_2, after analysis_1, 150d
Multivariate Trait Analysis, Inverts   :active,        analysis_3, after import_1, 180d
Univariate Trait Analysis, Verts       :active,        analysis_4, 2017-06-01, 2018-07-01
Multivariate Trait Analysis, Verts     :active,        analysis_5, after import_1, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Publish TreeTimer             :active,        first_2,    2017-11-01, 2018-01-31
Build Synthetic Trees          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Improve bayou priors, identifiability  :active, import_0, 2017-06-01, 2018-01-01
Multivariate bayou  :active,        import_1,   2018-01-01,240d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Invert Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis, Inverts     :active,        analysis_2, after analysis_1, 150d
Multivariate Trait Analysis, Inverts   :active,        analysis_3, after import_1, 240d
Univariate Trait Analysis, Verts       :active,        analysis_4, 2017-06-01, 2018-07-01
Multivariate Trait Analysis, Verts     :active,        analysis_5, after import_1, 240d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Build Synthetic Trees          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Improve bayou priors, identifiability  :active, import_0, 2017-06-01, 2018-01-01
Multivariate bayou  :active,        import_1,   2018-01-01,240d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Invert Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis, Inverts     :active,        analysis_2, after analysis_1, 150d
Multivariate Trait Analysis, Inverts   :active,        analysis_3, after import_1, 240d
Univariate Trait Analysis, Verts       :active,        analysis_4, 2017-06-01, 2018-07-01
Multivariate Trait Analysis, Verts     :active,        analysis_5, after import_1, 240d
section Manuscripts
TreeTimer Manuscript                  :active,  publish_1, 2018-02-01, 180d
Bayou 2.0 Manuscript                  :active,  publish_2, 2018-01-01, 180d
mvBayou Manuscript                    :active,  publish_3, 2018-07-01, 180d
")
mermaid("
gantt
dateFormat  YYYY-MM-DD
title Proposed timeline
section TreeTimer
Build TreeTimer Integrations  :active,        first_1,    2017-06-01, 2017-10-01
Build Synthetic Trees          :active,        first_3,    2017-12-01, 2018-01-31
section Methods Development
Improve bayou priors, identifiability  :active, import_0, 2017-06-01, 2018-01-01
Multivariate bayou  :active,        import_1,   2018-01-01,240d
Simulation study of mvBayou     :active,        import_2,   after import_1, 90d
section Trait Analysis
Build Invert Dataset, Version 1      :active,        analysis_1, 2017-06-01, 250d
Univariate Trait Analysis, Inverts     :active,        analysis_2, after analysis_1, 150d
Multivariate Trait Analysis, Inverts   :active,        analysis_3, after import_1, 240d
Univariate Trait Analysis, Verts       :active,        analysis_4, 2017-06-01, 2018-07-01
Multivariate Trait Analysis, Verts     :active,        analysis_5, after import_1, 240d
section Manuscripts
Bayou 2.0 Manuscript                  :active,  publish_2, 2017-11-01, 180d
TreeTimer Manuscript                  :active,  publish_1, 2018-02-01, 180d
mvBayou Manuscript                    :active,  publish_3, 2018-07-01, 180d
")
require(roxygen2)
require(devtools)
devtools::load_all("~/repos/bayou/bayou_1.0/")
setwd("~/repos/EQG2016/bayou/R/")
## # Preparing data for analysis with the R package treeplyr.
## We will use data from the Species 360 database of normal animal reference ranges for a variety of
## traits (formerly known as the International Species Information System = ISIS). The data file has
## been slightly modified here, but the original data file is available at:
## http://www2.isis.org/support/MEDARKS/Pages/Reference%20Ranges.aspx
sp360 <- readRDS("../data/species360.rds")
tbl_df(sp360)
## The tree file we are using is a mashup of several trees spliced together that includes 29,301 species of
## vertebrate.
tree <- read.tree("../data/tetrapods.tre")
tree <- multi2di(tree, random=FALSE)
tree$edge.length[tree$edge.length==0] <- .Machine$double.eps
## Matching the tree to the data is easy and fast in treeplyr, simply use the command make.treedata(). The
## resulting list includes a pruned tree 'phy' and a pruned data table in the same order as the tree 'dat':
td <- make.treedata(tree, sp360)
## Let's choose a trait to study. In this case, let's use Weight from 1.8-2.2 years old (this isn't the best
## dataset for body size, but we'll use it for now).
tdW <- filter(td, !is.na(Weight_1.82.2yearsage) & Weight_1.82.2yearsage > 0) %>%
mutate(., lnMass = log(Weight_1.82.2yearsage), lnMass.SD = Weight_1.82.2yearsage.SD/Weight_1.82.2yearsage,N = Weight_1.82.2yearsage.N) %>%
dplyr::select(., lnMass, lnMass.SD, N)
phenogram(tdW$phy, tdW[['lnMass']], spread.labels=FALSE, fsize=0.4)
## Run a bayou analysis by first setting up a prior distribution for parameters. First we're going to make sure
## we resolve polytomies and set zero length branches to some small value. I've also found it is easier to set
## priors if we scale the data. Note that to understand the parameter values, you must back-translate them using
## the scaling coefficients.
tree <- tdW$phy
dat <- tdW[[1]]
ME <- tdW[['lnMass.SD']]/sqrt(tdW[['N']])
priorOU <- make.prior(tree,
dists=list(dalpha="dhalfcauchy", dsig2="dhalfcauchy",
dk="cdpois", dtheta="dnorm"),
param=list(dk=list(lambda=15, kmax=200), dsb=list(bmax=1, prob=1),
dtheta=list(mean=mean(dat), sd=1.5*sd(dat)))
)
library(treeplyr)
## # Preparing data for analysis with the R package treeplyr.
## We will use data from the Species 360 database of normal animal reference ranges for a variety of
## traits (formerly known as the International Species Information System = ISIS). The data file has
## been slightly modified here, but the original data file is available at:
## http://www2.isis.org/support/MEDARKS/Pages/Reference%20Ranges.aspx
sp360 <- readRDS("../data/species360.rds")
tbl_df(sp360)
## The tree file we are using is a mashup of several trees spliced together that includes 29,301 species of
## vertebrate.
tree <- read.tree("../data/tetrapods.tre")
tree <- multi2di(tree, random=FALSE)
tree$edge.length[tree$edge.length==0] <- .Machine$double.eps
## Matching the tree to the data is easy and fast in treeplyr, simply use the command make.treedata(). The
## resulting list includes a pruned tree 'phy' and a pruned data table in the same order as the tree 'dat':
td <- make.treedata(tree, sp360)
## Let's choose a trait to study. In this case, let's use Weight from 1.8-2.2 years old (this isn't the best
## dataset for body size, but we'll use it for now).
tdW <- filter(td, !is.na(Weight_1.82.2yearsage) & Weight_1.82.2yearsage > 0) %>%
mutate(., lnMass = log(Weight_1.82.2yearsage), lnMass.SD = Weight_1.82.2yearsage.SD/Weight_1.82.2yearsage,N = Weight_1.82.2yearsage.N) %>%
dplyr::select(., lnMass, lnMass.SD, N)
phenogram(tdW$phy, tdW[['lnMass']], spread.labels=FALSE, fsize=0.4)
## Run a bayou analysis by first setting up a prior distribution for parameters. First we're going to make sure
## we resolve polytomies and set zero length branches to some small value. I've also found it is easier to set
## priors if we scale the data. Note that to understand the parameter values, you must back-translate them using
## the scaling coefficients.
tree <- tdW$phy
dat <- tdW[[1]]
ME <- tdW[['lnMass.SD']]/sqrt(tdW[['N']])
priorOU <- make.prior(tree,
dists=list(dalpha="dhalfcauchy", dsig2="dhalfcauchy",
dk="cdpois", dtheta="dnorm"),
param=list(dk=list(lambda=15, kmax=200), dsb=list(bmax=1, prob=1),
dtheta=list(mean=mean(dat), sd=1.5*sd(dat)))
)
## We can simulate some values from the prior distribution to test to make sure our prior function works.
startpars <- priorSim(priorOU, tree, plot=TRUE)$pars[[1]]
priorOU(startpars)
## Now that we have a prior function, let's build an MCMC object that will help us run our analyses.
set.seed(1)
par.halflife <- list(meanlog=3, sdlog=2.5)
#Draw a bunch of samples from this distribution:
samp <- rlnorm(10000, par.halflife$meanlog, par.halflife$sdlog)
hist(log(samp,10), breaks=100)
abline(v=log(c(1,max(branching.times(tree))),10), col="red", lwd=2, lty=2)
## Notice that there is about equal density of prior probability on the half-life being greater than tree height (rightmost
## red line) as there is below 1 million years (leftmost red line). The exact quantiles of this distribution are:
qlnorm(c(0.025, 0.25, 0.5, 0.75, 0.975), meanlog=par.halflife$meanlog, sdlog=par.halflife$sdlog)
## Second, we'll set the prior on the stationary variance of the OU process from the Blunderbuss model, as this seems to be
## the "niche width" we expect to see on million year timescales. We will center it at the estimate from the multiple-burst
## model from Uyeda et al. 2011:
par.Vy <- list(meanlog=log(0.0958), sdlog=0.2)
hist(rlnorm(10000, par.Vy$meanlog, par.Vy$sdlog))
priorBB <- make.prior(tree,
dists=list(dhalflife="dlnorm", dVy="dlnorm",
dk="cdpois", dsb="dsb", dtheta="dnorm"),
param=list(dhalflife=par.halflife,
dVy=par.Vy,
dk=list(lambda=15, kmax=200), dsb=list(bmax=1, prob=1),
dtheta=list(mean=mean(dat), sd=1.5*sd(dat))),
model="OUrepar"
)
## We then run everything as we did before.
startparsBB <- priorSim(priorBB, tree, plot=TRUE)$pars[[1]]
priorBB(startparsBB)
## Now that we have a prior function, let's build an MCMC object that will help us run our analyses.
set.seed(1)
mcmcBB <- bayou.makeMCMC(tree, dat, SE=ME, model="OUrepar", prior=priorBB, new.dir="../output/runs/modelBB/", outname="modelBB_r001", plot.freq=2000)
mcmcBB$run(10000)
chainBB <- mcmcBB$load()
chainBB <- set.burnin(chainBB, 0.3)
summary(chainBB)
plot(chainBB)
Bk <- qbeta(seq(0,1, length.out=5), 0.3,1)
ssBB <- mcmcBB$steppingstone(10000, chainBB, Bk, burnin=0.3, plot=FALSE)
source('~/repos/EQG2016/bayou/R/prepping.R')
